import{k as e}from"./p-8d15e3b9.js";import{t}from"./p-56a5bb59.js";class s{static async fetch(e,s,a){let r;const o={400:"请求参数错误",403:"拒绝访问",404:"资源不存在",500:"服务器内部错误",501:"服务未实现",502:"网关错误",503:"服务不可用",504:"网关超时",505:"HTTP版本不受支持"};return"get"==e?r=await this.fetchGet(s,a):"post"==e&&(r=await this.fetchPost(s,a)),o[r.status]&&t.create({message:s+" 请求出错: "+o[r.status],position:"bottom",duration:4e3}).then(e=>{e.present()}),await r.json()}static composeUri(e){var t="?";let s=Object.keys(e);for(let a=0;a<s.length;a++)t+=s[a]+"="+e[s[a]],a!=s.length-1&&(t+="&");return t}static async fetchGet(e,t){let a=new Headers,r=e+s.composeUri(t),o=new Request(r,{method:"GET",headers:a});return fetch(o,{mode:"cors"})}static async fetchPost(e,t){let s=new Headers;s.append("Content-Type","application/json");let a=new Request(e,{method:"POST",body:JSON.stringify(t),headers:s});return fetch(a,{mode:"cors"})}}let a=new Map,r=new Map;const o=(e,t)=>t?e.map(e=>{let s=e;return t.map(e=>{if(e.mapping){let t=s[e.mapping];delete s[e.name],delete s[e.mapping],t||console.error(`找不到${e.mapping}字段,请检查映射设置，或修改数据返回.`),s[e.name]=t}}),s}):e,n=(t,n,c)=>{if("static"==n.dataSourceType)a.set(t,()=>{let e=o(n.staticData,n.fieldMap);c(e)});else if("rest"==n.dataSourceType&&(a.set(t,()=>{(async(t,a,r)=>{let o="";return o=a?(await e().baseUrl||"")+r:r,await s.fetch(t,o,{})})(n.restType||"get",n.isSplicing||!1,n.restUrl||"").then(e=>{let t=o(e,n.fieldMap);c(o(t,n.fieldMap))})}),r.has(t)&&clearTimeout(r.get(t)),n.restRefreshTime&&n.restRefreshTime>0)){let e=setInterval(()=>{a.get(t)()},1e3*n.restRefreshTime);r.set(t,e)}a.get(t)()},c=e=>{a.get(e)()};export{n as a,c as r}