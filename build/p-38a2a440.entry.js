import{r as t,i as a,h as s,H as i,e as o}from"./p-6bae5055.js";import"./p-9a0f8c0e.js";import"./p-32d9e078.js";import"./p-6bc4a9f7.js";import{k as e,a as r,s as h,g as n,c,f as l,i as p,d as g}from"./p-8d15e3b9.js";import"./p-56a5bb59.js";import{a as d}from"./p-6ba4e7f4.js";const b=class{constructor(s){t(this,s),this.cyScale=a(this,"cyScale",7),this.cyDrag=a(this,"cyDrag",7),this.choose=a(this,"choose",7),this.canModify=!1,this.isChoose=!1,this.scale=1,this.isDomDrag=!1,this.isHover=!1}watchHandler(t){this.setZindexByChoose(t)}componentDidLoad(){this.setZindexByChoose(this.isChoose)}setZindexByChoose(t){this.el.style.zIndex=t?"999":""}onDragScaleDown(t,a,s,i){t.stopPropagation(),this.isDomDrag=!0;var o=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g),e=Math.floor(t.clientX-(o&&parseInt(o[0])*this.scale||0)-s*this.scale),r=Math.floor(t.clientY-(o&&parseInt(o[1])*this.scale||0)-i*this.scale),h=this.el.clientWidth,n=this.el.clientHeight,c=o[0],l=o[1];document.onpointermove=t=>{t.stopPropagation(),this.onDragScaleMove(t,a,e,r,h,n,parseInt(c),parseInt(l))},document.onpointerup=()=>{this.isDomDrag=!1,document.onpointermove=null,document.onpointerup=null;var t=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g);this.cyScale.emit({w:parseInt(this.el.clientWidth+""),h:parseInt(this.el.clientHeight+""),x:parseInt(t[0]),y:parseInt(t[1])})}}onDragScaleMove(t,a,s,i,o,e,r,h){switch(a){case"righttop":this.el.style.width=Math.floor((t.clientX-s)/this.scale)-r+"px";var n=Math.floor((e+h)*this.scale+i-t.clientY)/this.scale;this.el.style.height=n>0?n+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${r}px, ${(t.clientY-i)/this.scale}px`);break;case"lefttop":var c=Math.floor((o+r)*this.scale+s-t.clientX)/this.scale;this.el.style.width=c>0?c+"px":"0px",n=Math.floor((e+h)*this.scale+i-t.clientY)/this.scale,this.el.style.height=n>0?n+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-s)/this.scale}px, ${(t.clientY-i)/this.scale}px`);break;case"leftbottom":c=Math.floor((o+r)*this.scale+s-t.clientX)/this.scale,this.el.style.width=c>0?c+"px":"0px",this.el.style.height=Math.floor((t.clientY-i)/this.scale)-h+"px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-s)/this.scale}px, ${h}px`);break;case"rightbottom":this.el.style.width=Math.floor((t.clientX-s)/this.scale)-r+"px",this.el.style.height=Math.floor((t.clientY-i)/this.scale)-h+"px";break;case"top":n=Math.floor((e+h)*this.scale+i-t.clientY)/this.scale,this.el.style.height=n>0?n+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${r}px, ${(t.clientY-i)/this.scale}px`);break;case"left":c=Math.floor((o+r)*this.scale+s-t.clientX)/this.scale,this.el.style.width=c>0?c+"px":"0px",this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-s)/this.scale}px, ${h}px`);break;case"bottom":this.el.style.height=Math.floor((t.clientY-i)/this.scale)-h+"px";break;case"right":this.el.style.width=Math.floor((t.clientX-s)/this.scale)-r+"px"}}onDragBoxDown(t){t.preventDefault(),t.stopPropagation(),this.isDomDrag=!0;let a=t.clientX,s=t.clientY;var i=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g),o=a-(i&&parseInt(i[0])*this.scale||0),e=s-(i&&parseInt(i[1])*this.scale||0);document.onpointermove=t=>{t.stopPropagation(),this.onDragBoxMove(t,o,e)},document.onpointerup=()=>{this.isDomDrag=!1,document.onpointermove=null,document.onpointerup=null;var t=this.el.style.transform.match(/\-?[0-9]+\.?[0-9]*/g);this.cyDrag.emit({w:parseInt(this.el.clientWidth+""),h:parseInt(this.el.clientHeight+""),x:parseInt(t[0]),y:parseInt(t[1])})}}onDragBoxMove(t,a,s){this.el.style.transform=this.el.style.transform.replace(/translate(.*px, .*px)/g,`translate(${(t.clientX-a)/this.scale}px, ${(t.clientY-s)/this.scale}px`)}handleDomChoose(t){t.preventDefault(),t.stopPropagation(),this.choose.emit()}render(){return s(i,{style:{"touch-action":this.isChoose?"none":"auto",border:this.isHover&&this.canModify&&!this.isChoose?"1px solid var(--border-color)":""},onMouseEnter:()=>{this.isHover=!0},onMouseLeave:()=>{this.isHover=!1},onClick:t=>{this.handleDomChoose(t)},onPointerDown:t=>{this.canModify&&this.isChoose&&this.onDragBoxDown(t)}},s("div",{class:this.canModify&&this.isChoose||this.isDomDrag?"draggable_over":"draggable_over hiddlen"},s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_righttop",onPointerDown:t=>{this.onDragScaleDown(t,"righttop",this.el.clientWidth,0)}}),s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_rightbottom",onPointerDown:t=>{this.onDragScaleDown(t,"rightbottom",this.el.clientWidth,this.el.clientHeight)}}),s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_leftbottom",onPointerDown:t=>{this.onDragScaleDown(t,"leftbottom",0,this.el.clientHeight)}}),s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_lefttop",onPointerDown:t=>{this.onDragScaleDown(t,"lefttop",0,0)}}),s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_right",onPointerDown:t=>{this.onDragScaleDown(t,"right",this.el.clientWidth,Math.floor(.5*this.el.clientHeight))}}),s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_bottom",onPointerDown:t=>{this.onDragScaleDown(t,"bottom",Math.floor(.5*this.el.clientWidth),this.el.clientHeight)}}),s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_left",onPointerDown:t=>{this.onDragScaleDown(t,"left",0,Math.floor(.5*this.el.clientHeight))}}),s("i",{style:{transform:`scale(${(1/this.scale).toFixed(4)}, ${(1/this.scale).toFixed(4)})`},class:"drag_tag drag_tag_top",onPointerDown:t=>{this.onDragScaleDown(t,"top",Math.floor(.5*this.el.clientWidth),0)}})),s("div",{class:"container"},s("slot",null)))}get el(){return o(this)}static get watchers(){return{isChoose:["watchHandler"]}}};b.style=':host{--color:#ffffff;--background:transparent;--choose-background:rgb(27, 70, 117, 0.5);--padding:0px;--overflow:hidden;--opacity:1;--point-size:40px;--border-width:2px;padding:var(--padding);padding:0 !important;margin:0 !important;display:block;position:relative;will-change:transform;-webkit-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-box-sizing:border-box;box-sizing:border-box}*{-webkit-box-sizing:border-box;box-sizing:border-box}.container{width:100%;height:100%;color:var(--color);overflow:var(--overflow);opacity:var(--opacity)}.draggable_over{position:absolute;top:0;bottom:0;left:0;right:0;cursor:-webkit-grab;cursor:grab;z-index:999;border-width:var(--border-width);border-style:solid;border-color:var(--border-color);background:var(--choose-background)}.hiddlen{visibility:hidden;-webkit-box-shadow:none;box-shadow:none}.drag_tag{position:absolute;width:var(--point-size);height:var(--point-size);z-index:999;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;-ms-touch-action:none;touch-action:none}.drag_tag::before{content:"";position:relative;background:var(--color, #ffffff);width:calc(0.3 * var(--point-size));height:calc(0.3 * var(--point-size));border-radius:50%}.drag_tag_right{top:calc(50% - calc(0.5 * var(--point-size)));right:calc(-1 * calc(0.5 * var(--point-size)));cursor:move}.drag_tag_bottom{right:calc(50% - calc(0.5 * var(--point-size)));bottom:calc(-1 * calc(0.5 * var(--point-size)));cursor:move}.drag_tag_rightbottom{right:calc(-1 * calc(0.5 * var(--point-size)));bottom:calc(-1 * calc(0.5 * var(--point-size)));cursor:move}.drag_tag_righttop{right:0;right:calc(-1 * calc(0.5 * var(--point-size)));top:calc(-1 * calc(0.5 * var(--point-size)));cursor:move}.drag_tag_leftbottom{left:calc(-1 * calc(0.5 * var(--point-size)));bottom:calc(-1 * calc(0.5 * var(--point-size)));cursor:move}.drag_tag_left{top:calc(50% - calc(0.5* var(--point-size)));left:calc(-1 * calc(0.5* var(--point-size)));cursor:move}.drag_tag_lefttop{left:calc(-1 * calc(0.5 * var(--point-size)));top:calc(-1 * calc(0.5 * var(--point-size)));cursor:move}.drag_tag_top{top:calc(-1 * calc(0.5* var(--point-size)));left:calc(50% - calc(0.5* var(--point-size)));cursor:move}';const m=class{constructor(s){t(this,s),this.popover=a(this,"popover",7),this.canvasChange=a(this,"canvasChange",7),this.scale=100,this.canModify=!0,this.chooseComId="",this.comOptionList=[]}watchHandler(t){this.upDateElSize(this.canvasOption,t)}componentWillLoad(){p(this.el),this.canvasOption=e(),this.mapComDatasToState(r())}upDateElSize(t,a){this.el.style.width=Math.floor(a/100*parseInt(t.w))+"px",this.el.style.height=Math.floor(a/100*parseInt(t.h))+"px"}async setDataScreen(t,a,s=!0){h(t,a,s)}async getDataScreen(t){return await n(t)}async getCanvasSize(){return this.canvasOption?{w:parseInt(this.canvasOption.w),h:parseInt(this.canvasOption.h)}:null}async mapComDatasToState(t){this.comOptionList=t}async chooseComponentById(t){t!==this.chooseComId&&(this.chooseComId=t,await c(t))}async setCanvasConfig(t){this.canvasOption=Object.assign({},t),this.canvasChange.emit(),this.upDateElSize(this.canvasOption,this.scale)}handleDraggableDrag(t,a){a.data.view.x===t.detail.x&&a.data.view.y===t.detail.y||(a.data.view.x=t.detail.x+"",a.data.view.y=t.detail.y+"",l(a,!0,!0))}handleDraggableScale(t,a){a.data.view.w===t.detail.w&&a.data.view.h===t.detail.h||(a.data.view.w=t.detail.w+"",a.data.view.h=t.detail.h+"",a.data.view.x=t.detail.x+"",a.data.view.y=t.detail.y+"",l(a,!0,!0))}async popoverContextMenu(t,a){t.preventDefault(),t.stopPropagation(),await this.chooseComponentById(a),this.popover.emit({component:"popover-draggable-contextmenu",cssClass:"contextmenu-popover",event:t,showBackdrop:!1,componentProps:{comId:a}})}render(){return this.canvasOption?s("div",{class:"drag_container",style:{transform:`scale(${this.scale/100})`,width:this.canvasOption.w+"px",height:this.canvasOption.h+"px","background-color":this.canvasOption.bgc+"","background-image":this.canvasOption.bgi?`url(${this.canvasOption.bgi})`:"",overflow:this.canModify?"inherit":"hidden"}},this.comOptionList.map(t=>s("cy-draggable",{key:t.id,onContextMenu:a=>{this.canModify&&this.popoverContextMenu(a,t.id)},isChoose:this.chooseComId==t.id,canModify:this.canModify,scale:Math.round(this.scale)/100,onCyDrag:a=>{this.handleDraggableDrag(a,t)},onCyScale:a=>{this.handleDraggableScale(a,t)},onChoose:()=>{this.chooseComponentById(t.id)},style:{position:"absolute",transform:`translate(${t.data.view.x}px, ${t.data.view.y}px) rotate(${t.data.view.deg}deg)`,width:t.data.view.w+"px",height:t.data.view.h+"px","--opacity":t.data.view.opacity+""}},s("draggable-adapter",{key:t.id,comOptionData:t,canModify:this.canModify})))):null}get el(){return o(this)}static get watchers(){return{scale:["watchHandler"]}}};m.style="datascreen-canvas{--box-shadow:var(--ion-background-shade, #1c1c1c)  0 0 30px 0;--background:var(--datascreen-canvas-bg, #282830);display:inline-block;-webkit-transform-origin:0 0;transform-origin:0 0}datascreen-canvas .drag_container{position:absolute;width:100%;height:100%;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transition:.5s all ease-in;transition:.5s all ease-in;background-size:cover,contain;background-position:center,right bottom;background-repeat:no-repeat,no-repeat;-webkit-box-shadow:rgba(0,0,0,.5) 0 0 30px 0;box-shadow:rgba(0,0,0,.5) 0 0 30px 0}";const x=class{constructor(s){t(this,s),this.canvasScaleChange=a(this,"canvasScaleChange",7),this.minCanvasScale=15,this.maxCanvasSCale=300,this.padding=0}componentDidLoad(){this.resizeSCale()}customEventHandler(){this.resizeSCale()}async resizeSCale(){let t,a=this.el.querySelector("datascreen-canvas"),s=this.el.clientWidth-2*this.padding,i=this.el.clientHeight-2*this.padding,o=await a.getCanvasSize();a&&o&&o&&(t=o.w/o.h>s/i?s/o.w*100:i/o.h*100,t=t>this.minCanvasScale?t:this.minCanvasScale,t=t>this.maxCanvasSCale?this.maxCanvasSCale:t,t=Math.ceil(100*t)/100,this.canvasScaleChange.emit(t),a.scale=t)}render(){return s(i,{style:{padding:this.padding+"px"}},s("slot",null))}get el(){return o(this)}};x.style="datascreen-canvas-content{width:100%;height:100%;display:block;overflow:auto;position:relative;-webkit-box-sizing:border-box;box-sizing:border-box}";const v=class{constructor(s){t(this,s),this.alert=a(this,"alert",7),this.toast=a(this,"toast",7),this.canModify=!1}watchHandler(t,a){JSON.stringify(t.data.api_data)!==JSON.stringify(a.data.api_data)&&this.resignDataReceiver()}componentWillLoad(){this.resignDataReceiver()}resignDataReceiver(){this.comOptionData.data.api_data&&d(this.comOptionData.id,g({},this.comOptionData.data.api_data),t=>{this.apiData=t})}render(){switch(this.comOptionData.comName.split("-")[0]||""){case"media":return s("media-adapter",{canModify:this.canModify,comData:this.comOptionData,dataSource:this.apiData});case"chart":return s("chart-adapter",{comDataView:this.comOptionData.data.view,comDataConfig:this.comOptionData.data.config,comDataApiData:this.comOptionData.data.api_data,dataSource:this.apiData});case"text":return s("text-adapter",{comData:this.comOptionData,comDataConfig:this.comOptionData.data.config,dataSource:this.apiData});case"table":return s("table-adapter",{comDataView:this.comOptionData.data.view,comDataConfig:this.comOptionData.data.config,dataSource:this.apiData})}}static get watchers(){return{comOptionData:["watchHandler"]}}};v.style="";export{b as cy_draggable,m as datascreen_canvas,x as datascreen_canvas_content,v as draggable_adapter}