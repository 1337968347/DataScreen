import{r as t,i as o,h as e,H as i}from"./p-6bae5055.js";import"./p-9a0f8c0e.js";import"./p-32d9e078.js";import{D as s}from"./p-6bc4a9f7.js";import{p as l}from"./p-56a5bb59.js";import"./p-b18ab5ec.js";import{_ as n}from"./p-e3ed74b4.js";const a=class{constructor(e){t(this,e),this.toast=o(this,"toast",7),this.codeAll=""}componentWillLoad(){this.initCodeAll()}async initCodeAll(){if(this.dataScreenId){let t=await s.getDataScreen(this.dataScreenId);delete t.id,this.codeAll=JSON.stringify(t,null,1)}}handleCodeChange(t){this.codeAll=t.detail.value}checkDataOJBK(t){try{let o=JSON.parse(t);return!!(o.canvasOption.w&&o.canvasOption.h&&o.canvasOption.bgc&&-1!==Object.prototype.toString.call(o.componentsData).indexOf("Array"))||(this.toast.emit("缺少必要参数!"),!1)}catch(o){return console.error(o),this.toast.emit("数据格式错误!"),!1}}async saveComponentsData(){if(this.checkDataOJBK(this.codeAll)){let t=JSON.parse(this.codeAll);if(this.dataScreenId){let o=await s.getDataScreen(this.dataScreenId);t.id=o.id,await s.setDataScreenById(o.id,t)}else t.id=n.v4(),await s.addDataScreen(t);this.closePopover(t.id)}}cancelModify(){this.closePopover("")}closePopover(t){this.dismissCallBack&&this.dismissCallBack(t),l.dismiss()}render(){return e(i,{style:{flex:"1",display:"flex","flex-direction":"column"}},e("ion-toolbar",{color:"secondary"},e("ion-title",null,"show me the code")),e("div",{class:"popover_content"},e("ion-textarea",{placeholder:"复制大屏数据到这导入",debounce:300,wrap:"soft",onIonChange:t=>{this.handleCodeChange(t)},value:this.codeAll}),e("ion-row",null,e("ion-col",null,e("ion-button",{onClick:()=>{this.saveComponentsData()},color:"primary",expand:"block"},"保存")),e("ion-col",null,e("ion-button",{onClick:()=>{this.cancelModify()},color:"primary",fill:"outline",expand:"block"},"取消")))))}};a.style="ion-textarea{-ms-flex:1!important;flex:1!important;display:-ms-flexbox!important;display:flex!important;font-size:15px!important}.popover_content{-ms-flex:1;flex:1;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;overflow:hidden;-ms-flex-pack:justify;justify-content:space-between}";export{a as popover_code_modify}